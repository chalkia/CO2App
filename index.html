<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>CO2-app</title>
  <link href="./manifest.webmanifest" rel="manifest"/>
  <meta content="#74a974" name="theme-color"/>
  <meta content="yes" name="apple-mobile-web-app-capable"/>
  <link href="./assets/icons/icon-192.png" rel="apple-touch-icon"/>
  
  <script src="./js/version.js"></script>

  <script>
    function loadAsset(type, path) {
      var v = (typeof APP_BUILD !== 'undefined') ? APP_BUILD : Date.now();
      if (type === 'css') {
        document.write('<link rel="stylesheet" href="' + path + '?v=' + v + '">');
      } else if (type === 'js') {
        document.write('<script src="' + path + '?v=' + v + '"><\/script>');
      }
    }
    
    // Î¦ÏŒÏÏ„Ï‰ÏƒÎ· CSS (Î¼Îµ ./ ÎºÎ±Î¸ÏÏ‚ ÎµÎ¯Î¼Î±ÏƒÏ„Îµ ÏƒÏ„Î¿ root)
    loadAsset('css', './styles.css');
  </script>
</head>
<body class="homeNoDrawer">
  <div class="container">
    <div class="panel" id="mainPanel">
      <div style="height:12px"></div>
    </div>
    
    <div class="card homeCard centerCard">
      <div class="homeLogo">
        <img alt="CO2app" height="260" id="appLogo" src="./assets/logo.png" style="width:min(70vw,260px);max-width:260px;height:auto;display:block;margin:0 auto;" width="260"/>
      </div>
      <div class="homeDesc" id="homeDesc"></div>
      
      <button class="homePrimary" id="btnQuiz">
        <div class="homePrimaryTitle">
          <span id="homeQuizTitle"></span>
          <span class="badge orange" id="homeQuizBadge"></span>
        </div>
        <div class="homePrimarySub" id="homeQuizSub"></div>
      </button>
      
      <button class="homePrimary" id="btnFoot">
        <div class="homePrimaryTitle">
          <span id="homeFootTitle"></span>
          <span class="badge blue" id="homeFootBadge"></span>
        </div>
        <div class="homePrimarySub" id="homeFootSub"></div>
      </button>
      
      <div class="homeChips">
        <button class="homeChip" id="chipDocs">
          <img alt="Docs" class="homeChipIconImg" height="22" src="./assets/ui/bookN.png" style="width:22px;height:22px;display:block;" width="22"/>
          <span id="chipDocsText"></span>
        </button>
        <button class="homeChip" id="chipInstall">
          <span class="homeChipIcon">ğŸ“±</span>
          <span id="chipInstallText"></span>
        </button>
        <button class="homeChip" id="chipLang">
          <span class="homeChipIcon">ğŸŒ</span>
          <span id="chipLangText"></span>
        </button>
        <button class="homeChip" id="chipAbout">
          <span class="homeChipIcon">i</span>
          <span id="chipAboutText"></span>
        </button>
      </div>

      <div id="versionDisplay" style="text-align:center; font-size:0.85rem; color:#888; margin-top:1.5rem; opacity:0.7;"></div>
      <script>
        if (document.getElementById('versionDisplay') && typeof APP_VER !== 'undefined') {
          document.getElementById('versionDisplay').innerText = 'v' + APP_VER;
        }
      </script>

    </div>
  </div>

  <div id="updateToast" style="display:none; position:fixed; bottom:30px; left:50%; transform:translateX(-50%); background:#2d2d2d; color:white; padding:12px 24px; border-radius:50px; z-index:9999; box-shadow:0 6px 16px rgba(0,0,0,0.4); width:max-content; max-width:90%; text-align:center; align-items:center; gap:12px;">
    <span style="font-size:0.95rem; font-weight:500;">ÎÎ­Î± Î­ÎºÎ´Î¿ÏƒÎ· Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î·</span>
    <button id="refreshBtn" style="background:#74a974; color:white; border:none; padding:6px 16px; border-radius:20px; font-size:0.9rem; font-weight:bold; cursor:pointer; margin-left:10px;">
      Î‘Î½Î±Î½Î­Ï‰ÏƒÎ·
    </button>
  </div>

  <script>
    loadAsset('js', './js/common.js');
    loadAsset('js', './js/menu.js');
  </script>

  <script>
    const lang = getLang();

    const T = {
      el: {
        desc: "ÎœÎ¹Î± ÎµÎºÏ€Î±Î¹Î´ÎµÏ…Ï„Î¹ÎºÎ® ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Î³Î¹Î± Ï„Î¿ CO2.",
        quizTitle: "QUIZ",
        quizSub: "Î“Î½Ï‰ÏÎ¯Î¶ÎµÎ¹Ï‚ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ¬ Ï€Î¿Î¹Î¿Î¹ Ï€Î±ÏÎ¬Î³Î¿Î½Ï„ÎµÏ‚ Î±Ï…Î¾Î¬Î½Î¿Ï…Î½ Ï„Î¿ CO2;",
        quizBadge: "10 ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚",
        footTitle: "Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ COâ‚‚",
        footSub: "ÎšÎ¬Î½Îµ Î¼Î¹Î± ÎµÎºÏ„Î¯Î¼Î·ÏƒÎ· Î³Î¹Î± Ï„Î· Î´Î¹ÎºÎ® ÏƒÎ¿Ï… ÏƒÏ…Î¼Î²Î¿Î»Î® ÏƒÏ„Î·Î½ Î±ÏÎ¾Î·ÏƒÎ· Ï„Î¿Ï… COâ‚‚ ÏƒÏ„Î·Î½ Î±Ï„Î¼ÏŒÏƒÏ†Î±Î¹ÏÎ±.",
        footBadge: "4 ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚",
        docs: "Î¤ÎµÎºÎ¼Î·ÏÎ¯Ï‰ÏƒÎ·",
        lang: "Î‘Î»Î»Î±Î³Î® Î³Î»ÏÏƒÏƒÎ±Ï‚",
        about: "Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚",
        install: "Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· ÏƒÎµ ÎºÎ¹Î½Î·Ï„ÏŒ"
      },
      en: {
        desc: "An educational app about COâ‚‚ and climate, featuring a knowledge quiz and a carbon footprint calculator.",
        quizTitle: "QUIZ",
        quizSub: "Do you really know what rising COâ‚‚ means and how it affects the climate?",
        quizBadge: "10 questions",
        footTitle: "COâ‚‚ Calculator",
        footSub: "Estimate your own contribution to the rise of COâ‚‚ in the atmosphere.",
        footBadge: "4 categories",
        docs: "Documentation",
        lang: "Switch language",
        about: "About",
        install: "Install on phone"
      }
    }[lang];

    document.getElementById("homeDesc").textContent = T.desc;
    document.getElementById("homeQuizTitle").textContent = T.quizTitle;
    document.getElementById("homeQuizSub").textContent = T.quizSub;
    document.getElementById("homeQuizBadge").textContent = T.quizBadge;

    document.getElementById("homeFootTitle").textContent = T.footTitle;
    document.getElementById("homeFootSub").textContent = T.footSub;
    document.getElementById("homeFootBadge").textContent = T.footBadge;

    document.getElementById("chipDocsText").textContent = T.docs;
    document.getElementById("chipInstallText").textContent = T.install;
    document.getElementById("chipLangText").textContent = T.lang;
    document.getElementById("chipAboutText").textContent = T.about;

    // Î Î»Î¿Î®Î³Î·ÏƒÎ·
    document.getElementById("btnQuiz").addEventListener("click", ()=>go("./pages/quiz.html"));
    document.getElementById("btnFoot").addEventListener("click", ()=>go("./pages/footprint.html"));

    document.getElementById("chipDocs").addEventListener("click", ()=>go("./pages/model.html"));
    document.getElementById("chipInstall").addEventListener("click", ()=>go("./pages/install.html"));
    document.getElementById("chipAbout").addEventListener("click", ()=>go("./pages/info.html"));
    
    document.getElementById("chipLang").addEventListener("click", ()=>{
      const next = (lang === "el") ? "en" : "el";
      setLang(next);
      location.reload();
    });

    // --- SERVICE WORKER UPDATE LOGIC ---
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./service-worker.js").then(reg => {
          
          // 1. ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î®Î´Î· update Ï€Î¿Ï… Ï€ÎµÏÎ¹Î¼Î­Î½ÎµÎ¹
          if (reg.waiting) {
            showUpdateNotification(reg.waiting);
            return;
          }

          // 2. Î Î±ÏÎ±ÎºÎ¿Î»Î¿ÏÎ¸Î·ÏƒÎ· Î³Î¹Î± Î½Î­Î¿ update
          reg.addEventListener('updatefound', () => {
            const newWorker = reg.installing;
            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                showUpdateNotification(newWorker);
              }
            });
          });
        });

        // 3. Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î¿ reload ÏŒÏ„Î±Î½ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î¿ Î½Î­Î¿Ï‚ SW
        let refreshing;
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          if (refreshing) return;
          window.location.reload();
          refreshing = true;
        });
      });
    }

    function showUpdateNotification(worker) {
      const toast = document.getElementById('updateToast');
      const btn = document.getElementById('refreshBtn');
      if(toast && btn) {
        toast.style.display = 'flex'; 
        btn.onclick = () => {
          worker.postMessage({ action: 'skipWaiting' });
          btn.textContent = "...";
          btn.disabled = true;
        };
      }
    }
  </script>

  <div aria-hidden="true" class="drawerBackdrop" id="drawerBackdrop"></div>
  <nav aria-hidden="true" class="drawer" id="drawer">
    <div class="drawerHeader">
      <div class="drawerTitle">CO2app</div>
      <button aria-label="Close menu" class="iconBtn" id="drawerClose">Ã—</button>
    </div>
    <div class="drawerSection" id="drawerNav"></div>
    <div class="drawerSection" id="drawerLang"></div>
  </nav>
</body>
</html>


{
"type": "file",
"fileName": "quiz.js",
"fullContent": "let questions = [];\nlet idx = 0;\nlet score = 0;\nlet answers = []; // Αποθηκεύει τις απαντήσεις: {choice, correct, right}\nconst QUIZ_SCORE_KEY = \"quizScore\";\n\nasync function loadQuestions(){\n  // Cache no-store για να μην κρατάει παλιές εκδόσεις του JSON αν το αλλάξεις\n  const r = await fetch(\"../assets/questions/quiz2.json\", {cache: \"no-store\"});\n  return await r.json();\n}\n\nfunction getQuizLang() {\n  // Το common.js επιστρέφει 'el', αλλά το json θέλει 'gr'\n  return getLang() === \"el\" ? \"gr\" : \"en\";\n}\n\nfunction renderQuiz(){\n  const lang = getQuizLang();\n  \n  // 1. Έλεγχος Τερματισμού\n  if (idx >= questions.length) {\n    showFinishScreen(lang);\n    return;\n  }\n\n  const q = questions[idx];\n  const hasAnswered = answers[idx] !== null && answers[idx] !== undefined;\n\n  // 2. Ενημέρωση Στατιστικών\n  const qLabel = document.getElementById(\"qLabel\");\n  const sLabel = document.getElementById(\"scoreLabel\");\n  if(qLabel) qLabel.textContent = (lang===\"gr\" ? \"Ερ: \" : \"Q: \") + (idx+1) + \"/\" + questions.length;\n  if(sLabel) sLabel.textContent = (lang===\"gr\" ? \"Σκορ: \" : \"Score: \") + score;\n\n  // 3. Ενημέρωση Κειμένων Ερώτησης\n  document.getElementById(\"question\").textContent = q.question[lang];\n  document.getElementById(\"opt1\").textContent = q.a1[lang];\n  document.getElementById(\"opt2\").textContent = q.a2[lang];\n  document.getElementById(\"opt3\").textContent = q.a3[lang];\n  \n  const hintEl = document.getElementById(\"hint\");\n  if (hasAnswered) {\n      hintEl.textContent = \"\";\n  } else {\n      hintEl.textContent = (lang===\"gr\") ? \"Επίλεξε τη σωστή απάντηση\" : \"Choose the correct answer\";\n  }\n\n  // 4. Reset Visuals (καθαρισμός χρωμάτων)\n  document.querySelectorAll(\".optionText\").forEach(o => \n    o.classList.remove(\"answerCorrect\", \"answerWrong\", \"answerChosen\")\n  );\n  document.querySelectorAll(\".choiceBtn\").forEach(b => {\n    b.classList.remove(\"locked\");\n    b.disabled = false;\n  });\n\n  // 5. Αν έχει απαντηθεί, επανάφερε την κατάσταση (State Restore)\n  if (hasAnswered) {\n    const saved = answers[idx];\n    showFeedback(saved.choice, saved.right, lang, false); // false = μην αυξήσεις σκορ ξανά\n  } else {\n    // Κρύψε την κάρτα εξήγησης αν είναι νέα ερώτηση\n    document.getElementById(\"answerCard\").style.display = \"none\";\n    document.getElementById(\"btnNext\").disabled = true;\n  }\n\n  // Διαχείριση κουμπιού Prev\n  document.getElementById(\"btnPrev\").disabled = (idx === 0);\n}\n\nfunction showFeedback(choice, right, lang, updateScore) {\n  // Visuals\n  document.getElementById(\"opt\" + choice).classList.add(\"answerChosen\");\n  document.getElementById(\"opt\" + right).classList.add(\"answerCorrect\");\n  if (choice !== right) {\n    document.getElementById(\"opt\" + choice).classList.add(\"answerWrong\");\n  }\n\n  // Score Update (μόνο αν είναι η πρώτη φορά που απαντάει)\n  if (updateScore && choice === right) {\n    score += 10;\n    // Ενημέρωση label αμέσως\n    const sLabel = document.getElementById(\"scoreLabel\");\n    if(sLabel) sLabel.textContent = (lang===\"gr\" ? \"Σκορ: \" : \"Score: \") + score;\n  }\n\n  // Κλείδωμα κουμπιών\n  document.querySelectorAll(\".choiceBtn\").forEach(b => {\n    b.disabled = true;\n    b.classList.add(\"locked\");\n  });\n\n  // Εμφάνιση Επεξήγησης\n  const q = questions[idx];\n  const card = document.getElementById(\"answerCard\");\n  const titleEl = document.getElementById(\"answerTitle\");\n  const explainEl = document.getElementById(\"answerExplain\");\n  const sourceEl = document.getElementById(\"answerSource\");\n\n  titleEl.textContent = (choice === right) \n    ? (lang === \"gr\" ? \"Σωστά!\" : \"Correct!\") \n    : (lang === \"gr\" ? \"Λάθος.\" : \"Wrong.\");\n  \n  explainEl.textContent = q.explanation[lang];\n  \n  if (q.url) {\n    sourceEl.innerHTML = `<a href=\"${q.url}\" target=\"_blank\">${lang===\"gr\"?\"Πηγή\":\"Source\"}</a>`;\n  } else {\n    sourceEl.textContent = \"\";\n  }\n  \n  card.style.display = \"block\";\n\n  // Ενεργοποίηση Next\n  const nextBtn = document.getElementById(\"btnNext\");\n  nextBtn.disabled = false;\n  \n  // Αν είναι η τελευταία ερώτηση, άλλαξε το κείμενο του Next (προαιρετικά)\n  // if (idx === questions.length - 1) nextBtn.textContent = (lang===\"gr\" ? \"Τέλος\" : \"Finish\");\n}\n\nfunction handleAnswer(choice) {\n  // Αν έχει ήδη απαντηθεί, αγνόησε το κλικ\n  if (answers[idx]) return;\n\n  const q = questions[idx];\n  const right = Number(q.right);\n  const lang = getQuizLang();\n\n  // Αποθήκευση απάντησης\n  answers[idx] = {\n    choice: choice,\n    right: right,\n    correct: (choice === right)\n  };\n\n  showFeedback(choice, right, lang, true);\n}\n\nfunction showFinishScreen(lang) {\n  const card = document.querySelector(\".quizCard\");\n  \n  let msg = \"\";\n  if (score >= 80) msg = (lang===\"gr\") ? \"Άριστα!\" : \"Excellent!\";\n  else if (score >= 50) msg = (lang===\"gr\") ? \"Καλά τα πήγες!\" : \"Good job!\";\n  else msg = (lang===\"gr\") ? \"Μπορείς και καλύτερα!\" : \"Keep trying!\";\n\n  card.innerHTML = `\n    <div style=\"text-align:center; padding: 20px;\">\n      <h2>${lang===\"gr\" ? \"Τέλος Κουίζ\" : \"Quiz Finished\"}</h2>\n      <div style=\"font-size: 2em; font-weight:bold; margin: 20px 0; color:var(--primary);\">\n        ${score} / 100\n      </div>\n      <p>${msg}</p>\n    </div>\n  `;\n  \n  // Κρύψε τα υπόλοιπα UI elements\n  document.getElementById(\"choicesRow\").innerHTML = `\n    <button class=\"choiceBtn choiceWide\" id=\"restartBtn\">${lang===\"gr\"?\"Επανάληψη\":\"Restart\"}</button>\n  `;\n  document.getElementById(\"restartBtn\").addEventListener(\"click\", () => location.reload());\n  \n  document.getElementById(\"answerCard\").style.display = \"none\";\n  document.querySelector(\".quizNavTop\").style.display = \"none\";\n\n  // Αποθήκευση σκορ\n  localStorage.setItem(QUIZ_SCORE_KEY, score);\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", async () => {\n  initLangButtons();\n  \n  try {\n    questions = await loadQuestions();\n    // Αρχικοποίηση πίνακα απαντήσεων με null\n    answers = new Array(questions.length).fill(null);\n    \n    renderQuiz();\n\n    // Event Listeners για τις επιλογές (A, B, Γ)\n    document.querySelectorAll(\".choiceBtn[data-choice]\").forEach(b => {\n      b.addEventListener(\"click\", () => handleAnswer(Number(b.dataset.choice)));\n    });\n\n    // Navigation Buttons\n    document.getElementById(\"btnNext\").addEventListener(\"click\", () => {\n      if (idx < questions.length) {\n        idx++;\n        renderQuiz();\n      }\n    });\n\n    document.getElementById(\"btnPrev\").addEventListener(\"click\", () => {\n      if (idx > 0) {\n        idx--;\n        renderQuiz();\n      }\n    });\n\n    // Κλείσιμο κάρτας εξήγησης (προαιρετικό, αν θέλει ο χρήστης να βλέπει την ερώτηση)\n    const closeBtn = document.getElementById(\"btnAnswerClose\");\n    if (closeBtn) {\n      closeBtn.addEventListener(\"click\", () => {\n        document.getElementById(\"answerCard\").style.display = \"none\";\n      });\n    }\n\n  } catch (e) {\n    console.error(\"Quiz load failed:\", e);\n    document.getElementById(\"question\").textContent = \"Error loading quiz.\";\n  }\n});\n"
}
